<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link id="Estilo" rel="stylesheet" type="text/css" href="/css/padrao/buscar-projeto.css">
    <script>
        // Função para listar os projetos
        async function filtrarProjetos() {
            // Capturar os valores dos filtros
            const status = document.getElementById('status').value;
            const prioridade = document.getElementById('prioridade').value;
    
            // Criar objeto com os dados para enviar
            const dadosFiltro = {
                status: status,
                prioridade: prioridade
            };
    
            try {
                const response = await fetch('/api/projetos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dadosFiltro)
                }); 
                console.log(response)
                if (!response.ok) {
                    throw new Error('Erro na requisição');
                }
    
                const projetos = await response.json();
    
                // Renderizar resultados
                const resultadoDiv = document.getElementById('resultadoProjetos');
                resultadoDiv.innerHTML = '';
    
                if (projetos.length === 0) {
                    resultadoDiv.innerHTML = '<p>Nenhum projeto encontrado.</p>';
                    return;
                }
    
                const listaProjetos = document.createElement('ul');
                projetos.forEach(projeto => {
                    const item = document.createElement('li');
                    item.textContent = `Titulo: ${projeto.Titulo} - Status: ${projeto.Status} - Prioridade: ${projeto.Prioridade}`;
                    listaProjetos.appendChild(item);
                });
    
                resultadoDiv.appendChild(listaProjetos);
    
            } catch (error) {
                console.error('Erro ao buscar projetos:', error);
                document.getElementById('resultadoProjetos').innerHTML = '<p>Erro ao carregar projetos.</p>';
            }
        }
    </script>
    <title>Tela Inicial</title>
</head>
<body>
    <div id="Tela-Inicio">
        <aside id="sidebar">
            <nav id="Menu">
                <img src="/src/padrao.jpg" alt="User Photo">
                <h3><%= user.username %></h3>
                <!-- Link dinâmico visível apenas para usuários -->
                <% if (user.role === "administrador" || user.role === "gerente") { %>
                    <a href="/Criar-Projeto" class="Menu-Item">Novo Projeto</a>
                    <a href="/Modificar-Usuario" class="Menu-Item">Modificar Usuario</a>
                <% } %>
                <a href="/Buscar-Projeto" class="Menu-Item">Pesquisar por Projeto</a>
                <a href="/Buscar-Tarefa" class="Menu-Item">Pesquisar por Tarefa</a>
            </nav>
            <div id="Configuracao">
                <button type="button" id="mudar-tema">Mudar Tema</button>
                <a href="/logout" class="Menu-Configuracao">Sair</a>
            </div>
        </aside>
        <div id="Conteudo-Principal">
            <!-- Filtro de Projetos -->
            <section id="filtroProjetos">
                <h2>Filtrar Projetos</h2>
                <label for="status">Status:</label>
                <select id="status" name="status">
                    <option value="Todos">Todos</option>
                    <option value="Ativo">Ativo</option>
                    <option value="Concluido">Concluído</option>
                    <option value="Atrasado">Atrasado</option>
                </select>

                <label for="prioridade">Prioridade:</label>
                <select id="prioridade" name="prioridade">
                    <option value="Todos">Todos</option>
                    <option value="Alta">Alta</option>
                    <option value="Media">Média</option>
                    <option value="Baixa">Baixa</option>
                </select>

                <button id="buscarProjeto" onclick="filtrarProjetos()">Buscar Projetos</button>
            </section>

            <div id="resultadoProjetos">
                <!-- Projetos filtrados serão mostrados aqui -->
            </div>
        </div>
    </div>
</body>
</html>